---
- name: Check if proxy_bind directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_bind is defined
    - _http_config_file.proxy_bind.off | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: proxy_bind off;
    owner: root
    group: root
    mode: '0640'
  register: _proxy_bind_off_directive

- name: Verify proxy_bind directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_bind is defined
    - _http_config_file.proxy_bind.off | default(false)
  ansible.builtin.assert:
    that:
      - not _proxy_bind_off_directive.changed
    fail_msg: proxy_bind directive is not set in HTTP config file.
    success_msg: proxy_bind directive is set in HTTP config file.

- name: Check if proxy_bind directive is set in HTTP config file
  when:
    - _http_config_file.proxy_bind is defined
    - not _http_config_file.proxy_bind.off | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: >-
      proxy_bind {{ _http_config_file.proxy_bind.address -}}
        {{- ' transparent' if _http_config_file.proxy_bind.transparent | default(false) }};
    owner: root
    group: root
    mode: '0640'
  register: _proxy_bind_directive

- name: Verify proxy_bind directive is set in HTTP config file
  when:
    - _http_config_file.proxy_bind is defined
    - not _http_config_file.proxy_bind.off | default(false)
  ansible.builtin.assert:
    that:
      - not _proxy_bind_directive.changed
    fail_msg: proxy_bind directive is not set in HTTP config file.
    success_msg: proxy_bind directive is set in HTTP config file.

- name: Check if proxy_buffer_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_buffer_size is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_buffer_size {{ _http_config_file.proxy_buffer_size }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_buffer_size_directive

- name: Verify proxy_buffer_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_buffer_size is defined
  ansible.builtin.assert:
    that:
      - not _proxy_buffer_size_directive.changed
    fail_msg: proxy_buffer_size directive is not set in HTTP config file.
    success_msg: proxy_buffer_size directive is set in HTTP config file.

- name: Check if proxy_buffering directive is set in HTTP config file
  when:
    - _http_config_file.proxy_buffering is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_buffering {{ _http_config_file.proxy_buffering | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_buffering_directive

- name: Verify proxy_buffering directive is set in HTTP config file
  when:
    - _http_config_file.proxy_buffering is defined
  ansible.builtin.assert:
    that:
      - not _proxy_buffering_directive.changed
    fail_msg: proxy_buffering directive is not set in HTTP config file.
    success_msg: proxy_buffering directive is set in HTTP config file.

- name: Check if proxy_buffers directive is set in HTTP config file
  when:
    - _http_config_file.proxy_buffers is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_buffers {{ _http_config_file.proxy_buffers.count }} {{ _http_config_file.proxy_buffers.size }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_buffers_directive

- name: Verify proxy_buffers directive is set in HTTP config file
  when:
    - _http_config_file.proxy_buffers is defined
  ansible.builtin.assert:
    that:
      - not _proxy_buffers_directive.changed
    fail_msg: proxy_buffers directive is not set in HTTP config file.
    success_msg: proxy_buffers directive is set in HTTP config file.

- name: Check if proxy_busy_buffers_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_busy_buffers_size is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_busy_buffers_size {{ _http_config_file.proxy_busy_buffers_size }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_busy_buffers_size_directive

- name: Verify proxy_busy_buffers_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_busy_buffers_size is defined
  ansible.builtin.assert:
    that:
      - not _proxy_busy_buffers_size_directive.changed
    fail_msg: proxy_busy_buffers_size directive is not set in HTTP config file.
    success_msg: proxy_busy_buffers_size directive is set in HTTP config file.

- name: Check if proxy_cache directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cache {{ _http_config_file.proxy_cache }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_directive

- name: Verify proxy_cache directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache is defined
  ansible.builtin.assert:
    that:
      - not _proxy_cache_directive.changed
    fail_msg: proxy_cache directive is not set in HTTP config file.
    success_msg: proxy_cache directive is set in HTTP config file.

- name: Check if proxy_cache_background_update directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_background_update is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cache_background_update {{ _http_config_file.proxy_cache_background_update | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_background_update_directive

- name: Verify proxy_cache_background_update directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_background_update is defined
  ansible.builtin.assert:
    that:
      - not _proxy_cache_background_update_directive.changed
    fail_msg: proxy_cache_background_update directive is not set in HTTP config file.
    success_msg: proxy_cache_background_update directive is set in HTTP config file.

- name: Check if proxy_cache_bypass directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_bypass is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cache_bypass {{ _http_config_file.proxy_cache_bypass | join(' ') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_bypass_directive

- name: Verify proxy_cache_bypass directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_bypass is defined
  ansible.builtin.assert:
    that:
      - not _proxy_cache_bypass_directive.changed
    fail_msg: proxy_cache_bypass directive is not set in HTTP config file.
    success_msg: proxy_cache_bypass directive is set in HTTP config file.

- name: Check if proxy_cache_convert_head directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_convert_head is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cache_convert_head {{ _http_config_file.proxy_cache_convert_head | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_convert_head_directive

- name: Verify proxy_cache_convert_head directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_convert_head is defined
  ansible.builtin.assert:
    that:
      - not _proxy_cache_convert_head_directive.changed
    fail_msg: proxy_cache_convert_head directive is not set in HTTP config file.
    success_msg: proxy_cache_convert_head directive is set in HTTP config file.

- name: Check if proxy_cache_key directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_key is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cache_key {{ _http_config_file.proxy_cache_key }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_key_directive

- name: Verify proxy_cache_key directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_key is defined
  ansible.builtin.assert:
    that:
      - not _proxy_cache_key_directive.changed
    fail_msg: proxy_cache_key directive is not set in HTTP config file.
    success_msg: proxy_cache_key directive is set in HTTP config file.

- name: Check if proxy_cache_lock directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_lock is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cache_lock {{ _http_config_file.proxy_cache_lock | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_lock_directive

- name: Verify proxy_cache_lock directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_lock is defined
  ansible.builtin.assert:
    that:
      - not _proxy_cache_lock_directive.changed
    fail_msg: proxy_cache_lock directive is not set in HTTP config file.
    success_msg: proxy_cache_lock directive is set in HTTP config file.

- name: Check if proxy_cache_lock_age directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_lock_age is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cache_lock_age {{ _http_config_file.proxy_cache_lock_age }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_lock_age_directive

- name: Verify proxy_cache_lock_age directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_lock_age is defined
  ansible.builtin.assert:
    that:
      - not _proxy_cache_lock_age_directive.changed
    fail_msg: proxy_cache_lock_age directive is not set in HTTP config file.
    success_msg: proxy_cache_lock_age directive is set in HTTP config file.

- name: Check if proxy_cache_lock_timeout directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_lock_timeout is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cache_lock_timeout {{ _http_config_file.proxy_cache_lock_timeout }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_lock_timeout_directive

- name: Verify proxy_cache_lock_timeout directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_lock_timeout is defined
  ansible.builtin.assert:
    that:
      - not _proxy_cache_lock_timeout_directive.changed
    fail_msg: proxy_cache_lock_timeout directive is not set in HTTP config file.
    success_msg: proxy_cache_lock_timeout directive is set in HTTP config file.

- name: Check if proxy_cache_max_range_offset directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_max_range_offset is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cache_max_range_offset {{ _http_config_file.proxy_cache_max_range_offset }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_max_range_offset_directive

- name: Verify proxy_cache_max_range_offset directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_max_range_offset is defined
  ansible.builtin.assert:
    that:
      - not _proxy_cache_max_range_offset_directive.changed
    fail_msg: proxy_cache_max_range_offset directive is not set in HTTP config file.
    success_msg: proxy_cache_max_range_offset directive is set in HTTP config file.

- name: Check if proxy_cache_methods directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_methods is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cache_methods {{ _http_config_file.proxy_cache_methods | join(' ') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_methods_directive

- name: Verify proxy_cache_methods directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_methods is defined
  ansible.builtin.assert:
    that:
      - not _proxy_cache_methods_directive.changed
    fail_msg: proxy_cache_methods directive is not set in HTTP config file.
    success_msg: proxy_cache_methods directive is set in HTTP config file.

- name: Check if proxy_cache_purge directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_purge is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cache_purge {{ _http_config_file.proxy_cache_purge | join(' ') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_purge_directive

- name: Verify proxy_cache_purge directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_purge is defined
  ansible.builtin.assert:
    that:
      - not _proxy_cache_purge_directive.changed
    fail_msg: proxy_cache_purge directive is not set in HTTP config file.
    success_msg: proxy_cache_purge directive is set in HTTP config file.

- name: Check if proxy_cache_revalidate directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_revalidate is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cache_revalidate {{ _http_config_file.proxy_cache_revalidate | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_revalidate_directive

- name: Verify proxy_cache_revalidate directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_revalidate is defined
  ansible.builtin.assert:
    that:
      - not _proxy_cache_revalidate_directive.changed
    fail_msg: proxy_cache_revalidate directive is not set in HTTP config file.
    success_msg: proxy_cache_revalidate directive is set in HTTP config file.

- name: Check if proxy_cache_use_stale directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_cache_use_stale is defined
    - _http_config_file.proxy_cache_use_stale.off | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: proxy_cache_use_stale off;
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_use_stale_off_directive

- name: Verify proxy_cache_use_stale directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_cache_use_stale is defined
    - _http_config_file.proxy_cache_use_stale.off | default(false)
  ansible.builtin.assert:
    that:
      - not _proxy_cache_use_stale_off_directive.changed
    fail_msg: proxy_cache_use_stale directive is not set in HTTP config file.
    success_msg: proxy_cache_use_stale directive is set in HTTP config file.

- name: Check if proxy_cache_use_stale directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_use_stale is defined
    - not _http_config_file.proxy_cache_use_stale.off | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cache_use_stale {{ _http_config_file.proxy_cache_use_stale.conditions | join(' ') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_use_stale_directive

- name: Verify proxy_cache_use_stale directive is set in HTTP config file
  when:
    - _http_config_file.proxy_cache_use_stale is defined
    - not _http_config_file.proxy_cache_use_stale.off | default(false)
  ansible.builtin.assert:
    that:
      - not _proxy_cache_use_stale_directive.changed
    fail_msg: proxy_cache_use_stale directive is not set in HTTP config file.
    success_msg: proxy_cache_use_stale directive is set in HTTP config file.

- name: Check if proxy_cache_valid directive is set in HTTP config file
  loop: "{{ _http_config_file.proxy_cache_valid | default([]) }}"
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: >-
      proxy_cache_valid {{ ((item.codes | join(' ')) + ' ') if item.codes | default([]) | length > 0 -}}
        {{- item.time }};
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_valid_directive

- name: Verify proxy_cache_valid directive is set in HTTP config file
  loop: "{{ _proxy_cache_valid_directive.results }}"
  ansible.builtin.assert:
    that:
      - not item.changed
    fail_msg: proxy_cache_valid directive is not set in HTTP config file.
    success_msg: proxy_cache_valid directive is set in HTTP config file.
  loop_control:
    label: "{{ item.item }}"

- name: Check if proxy_connect_timeout directive is set in HTTP config file
  when:
    - _http_config_file.proxy_connect_timeout is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_connect_timeout {{ _http_config_file.proxy_connect_timeout }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_connect_timeout_directive

- name: Verify proxy_connect_timeout directive is set in HTTP config file
  when:
    - _http_config_file.proxy_connect_timeout is defined
  ansible.builtin.assert:
    that:
      - not _proxy_connect_timeout_directive.changed
    fail_msg: proxy_connect_timeout directive is not set in HTTP config file.
    success_msg: proxy_connect_timeout directive is set in HTTP config file.

- name: Check if proxy_cookie_domain directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_cookie_domain is defined
    - _http_config_file.proxy_cookie_domain.off | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: proxy_cookie_domain off;
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cookie_domain_off_directive

- name: Verify proxy_cookie_domain directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_cookie_domain is defined
    - _http_config_file.proxy_cookie_domain.off | default(false)
  ansible.builtin.assert:
    that:
      - not _proxy_cookie_domain_off_directive.changed
    fail_msg: proxy_cookie_domain directive is not set in HTTP config file.
    success_msg: proxy_cookie_domain directive is set in HTTP config file.

- name: Check if proxy_cookie_domain directive is set in HTTP config file
  loop: "{{ _http_config_file.proxy_cookie_domain.domains | default([]) }}"
  when:
    - _http_config_file.proxy_cookie_domain is defined
    - not _http_config_file.proxy_cookie_domain.off | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cookie_domain {{ item.domain }} {{ item.replacement }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cookie_domain_directive

- name: Verify proxy_cookie_domain directive is set in HTTP config file
  loop: "{{ _proxy_cookie_domain_directive.results }}"
  when:
    - _http_config_file.proxy_cookie_domain is defined
    - not _http_config_file.proxy_cookie_domain.off | default(false)
  ansible.builtin.assert:
    that:
      - not item.changed
    fail_msg: proxy_cookie_domain directive is not set in HTTP config file.
    success_msg: proxy_cookie_domain directive is set in HTTP config file.
  loop_control:
    label: "{{ item.item }}"

- name: Check if proxy_cookie_flags directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_cookie_flags is defined
    - _http_config_file.proxy_cookie_flags.off | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: proxy_cookie_flags off;
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cookie_flags_off_directive

- name: Verify proxy_cookie_flags directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_cookie_flags is defined
    - _http_config_file.proxy_cookie_flags.off | default(false)
  ansible.builtin.assert:
    that:
      - not _proxy_cookie_flags_off_directive.changed
    fail_msg: proxy_cookie_flags directive is not set in HTTP config file.
    success_msg: proxy_cookie_flags directive is set in HTTP config file.

- name: Check if proxy_cookie_flags directive is set in HTTP config file
  loop: "{{ _http_config_file.proxy_cookie_flags.flags | default([]) }}"
  when:
    - _http_config_file.proxy_cookie_flags is defined
    - not _http_config_file.proxy_cookie_flags.off | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: >-
      proxy_cookie_flags {{ item.cookie -}}
        {{- ' ' + item.flags | default([]) | join(' ') if item.flags | default([]) | length > 0 }};
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cookie_flags_directive

- name: Verify proxy_cookie_flags directive is set in HTTP config file
  loop: "{{ _proxy_cookie_flags_directive.results }}"
  when:
    - _http_config_file.proxy_cookie_flags is defined
    - not _http_config_file.proxy_cookie_flags.off | default(false)
  ansible.builtin.assert:
    that:
      - not item.changed
    fail_msg: proxy_cookie_flags directive is not set in HTTP config file.
    success_msg: proxy_cookie_flags directive is set in HTTP config file.
  loop_control:
    label: "{{ item.item }}"

- name: Check if proxy_cookie_path directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_cookie_path is defined
    - _http_config_file.proxy_cookie_path.off | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: proxy_cookie_path off;
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cookie_path_off_directive

- name: Verify proxy_cookie_path directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_cookie_path is defined
    - _http_config_file.proxy_cookie_path.off | default(false)
  ansible.builtin.assert:
    that:
      - not _proxy_cookie_path_off_directive.changed
    fail_msg: proxy_cookie_path directive is not set in HTTP config file.
    success_msg: proxy_cookie_path directive is set in HTTP config file.

- name: Check if proxy_cookie_path directive is set in HTTP config file
  loop: "{{ _http_config_file.proxy_cookie_path.paths | default([]) }}"
  when:
    - _http_config_file.proxy_cookie_path is defined
    - not _http_config_file.proxy_cookie_path.off | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_cookie_path {{ item.path }} {{ item.replacement }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cookie_path_directive

- name: Verify proxy_cookie_path directive is set in HTTP config file
  loop: "{{ _proxy_cookie_path_directive.results }}"
  when:
    - _http_config_file.proxy_cookie_path is defined
    - not _http_config_file.proxy_cookie_path.off | default(false)
  ansible.builtin.assert:
    that:
      - not item.changed
    fail_msg: proxy_cookie_path directive is not set in HTTP config file.
    success_msg: proxy_cookie_path directive is set in HTTP config file.
  loop_control:
    label: "{{ item.item }}"

- name: Check if proxy_force_ranges directive is set in HTTP config file
  when:
    - _http_config_file.proxy_force_ranges is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_force_ranges {{ _http_config_file.proxy_force_ranges | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_force_ranges_directive

- name: Verify proxy_force_ranges directive is set in HTTP config file
  when:
    - _http_config_file.proxy_force_ranges is defined
  ansible.builtin.assert:
    that:
      - not _proxy_force_ranges_directive.changed
    fail_msg: proxy_force_ranges directive is not set in HTTP config file.
    success_msg: proxy_force_ranges directive is set in HTTP config file.

- name: Check if proxy_headers_hash_bucket_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_headers_hash_bucket_size is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_headers_hash_bucket_size {{ _http_config_file.proxy_headers_hash_bucket_size }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_headers_hash_bucket_size_directive

- name: Verify proxy_headers_hash_bucket_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_headers_hash_bucket_size is defined
  ansible.builtin.assert:
    that:
      - not _proxy_headers_hash_bucket_size_directive.changed
    fail_msg: proxy_headers_hash_bucket_size directive is not set in HTTP config file.
    success_msg: proxy_headers_hash_bucket_size directive is set in HTTP config file.

- name: Check if proxy_headers_hash_max_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_headers_hash_max_size is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_headers_hash_max_size {{ _http_config_file.proxy_headers_hash_max_size }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_headers_hash_max_size_directive

- name: Verify proxy_headers_hash_max_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_headers_hash_max_size is defined
  ansible.builtin.assert:
    that:
      - not _proxy_headers_hash_max_size_directive.changed
    fail_msg: proxy_headers_hash_max_size directive is not set in HTTP config file.
    success_msg: proxy_headers_hash_max_size directive is set in HTTP config file.

- name: Check if proxy_hide_header directive is set in HTTP config file
  loop: "{{ _http_config_file.proxy_hide_header | default([]) }}"
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_hide_header {{ item }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_hide_header_directive

- name: Verify proxy_hide_header directive is set in HTTP config file
  loop: "{{ _proxy_hide_header_directive.results }}"
  ansible.builtin.assert:
    that:
      - not item.changed
    fail_msg: proxy_hide_header directive is not set in HTTP config file.
    success_msg: proxy_hide_header directive is set in HTTP config file.
  loop_control:
    label: "{{ item.item }}"

- name: Check if proxy_http_version directive is set in HTTP config file
  when:
    - _http_config_file.proxy_http_version is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_http_version {{ _http_config_file.proxy_http_version }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_http_version_directive

- name: Verify proxy_http_version directive is set in HTTP config file
  when:
    - _http_config_file.proxy_http_version is defined
  ansible.builtin.assert:
    that:
      - not _proxy_http_version_directive.changed
    fail_msg: proxy_http_version directive is not set in HTTP config file.
    success_msg: proxy_http_version directive is set in HTTP config file.

- name: Check if proxy_ignore_client_abort directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ignore_client_abort is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ignore_client_abort {{ _http_config_file.proxy_ignore_client_abort | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ignore_client_abort_directive

- name: Verify proxy_ignore_client_abort directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ignore_client_abort is defined
  ansible.builtin.assert:
    that:
      - not _proxy_ignore_client_abort_directive.changed
    fail_msg: proxy_ignore_client_abort directive is not set in HTTP config file.
    success_msg: proxy_ignore_client_abort directive is set in HTTP config file.

- name: Check if proxy_ignore_headers directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ignore_headers | default([]) | length > 0
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ignore_headers {{ _http_config_file.proxy_ignore_headers | join(' ') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ignore_headers_directive

- name: Verify proxy_ignore_headers directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ignore_headers | default([]) | length > 0
  ansible.builtin.assert:
    that:
      - not _proxy_ignore_headers_directive.changed
    fail_msg: proxy_ignore_headers directive is not set in HTTP config file.
    success_msg: proxy_ignore_headers directive is set in HTTP config file.

- name: Check if proxy_intercept_errors directive is set in HTTP config file
  when:
    - _http_config_file.proxy_intercept_errors is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_intercept_errors {{ _http_config_file.proxy_intercept_errors | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_intercept_errors_directive

- name: Verify proxy_intercept_errors directive is set in HTTP config file
  when:
    - _http_config_file.proxy_intercept_errors is defined
  ansible.builtin.assert:
    that:
      - not _proxy_intercept_errors_directive.changed
    fail_msg: proxy_intercept_errors directive is not set in HTTP config file.
    success_msg: proxy_intercept_errors directive is set in HTTP config file.

- name: Check if proxy_limit_rate directive is set in HTTP config file
  when:
    - _http_config_file.proxy_limit_rate is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_limit_rate {{ _http_config_file.proxy_limit_rate }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_limit_rate_directive

- name: Verify proxy_limit_rate directive is set in HTTP config file
  when:
    - _http_config_file.proxy_limit_rate is defined
  ansible.builtin.assert:
    that:
      - not _proxy_limit_rate_directive.changed
    fail_msg: proxy_limit_rate directive is not set in HTTP config file.
    success_msg: proxy_limit_rate directive is set in HTTP config file.

- name: Check if proxy_max_temp_file_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_max_temp_file_size is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_max_temp_file_size {{ _http_config_file.proxy_max_temp_file_size }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_max_temp_file_size_directive

- name: Verify proxy_max_temp_file_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_max_temp_file_size is defined
  ansible.builtin.assert:
    that:
      - not _proxy_max_temp_file_size_directive.changed
    fail_msg: proxy_max_temp_file_size directive is not set in HTTP config file.
    success_msg: proxy_max_temp_file_size directive is set in HTTP config file.

- name: Check if proxy_max_temp_file_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_max_temp_file_size is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_max_temp_file_size {{ _http_config_file.proxy_max_temp_file_size }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_max_temp_file_size_directive

- name: Verify proxy_max_temp_file_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_max_temp_file_size is defined
  ansible.builtin.assert:
    that:
      - not _proxy_max_temp_file_size_directive.changed
    fail_msg: proxy_max_temp_file_size directive is not set in HTTP config file.
    success_msg: proxy_max_temp_file_size directive is set in HTTP config file.

- name: Check if proxy_method directive is set in HTTP config file
  when:
    - _http_config_file.proxy_method is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_method {{ _http_config_file.proxy_method }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_method_directive

- name: Verify proxy_method directive is set in HTTP config file
  when:
    - _http_config_file.proxy_method is defined
  ansible.builtin.assert:
    that:
      - not _proxy_method_directive.changed
    fail_msg: proxy_method directive is not set in HTTP config file.
    success_msg: proxy_method directive is set in HTTP config file.

- name: Check if proxy_next_upstream directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_next_upstream is defined
    - _http_config_file.proxy_next_upstream.off | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: proxy_next_upstream off;
    owner: root
    group: root
    mode: '0640'
  register: _proxy_next_upstream_off_directive

- name: Verify proxy_next_upstream directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_next_upstream is defined
    - _http_config_file.proxy_next_upstream.off | default(false)
  ansible.builtin.assert:
    that:
      - not _proxy_next_upstream_off_directive.changed
    fail_msg: proxy_next_upstream directive is not set in HTTP config file.
    success_msg: proxy_next_upstream directive is set in HTTP config file.

- name: Check if proxy_next_upstream directive is set in HTTP config file
  when:
    - _http_config_file.proxy_next_upstream is defined
    - not _http_config_file.proxy_next_upstream.off | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_next_upstream {{ _http_config_file.proxy_next_upstream.conditions | join(' ') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_next_upstream_directive

- name: Verify proxy_next_upstream directive is set in HTTP config file
  when:
    - _http_config_file.proxy_next_upstream is defined
    - not _http_config_file.proxy_next_upstream.off | default(false)
  ansible.builtin.assert:
    that:
      - not _proxy_next_upstream_directive.changed
    fail_msg: proxy_next_upstream directive is not set in HTTP config file.
    success_msg: proxy_next_upstream directive is set in HTTP config file.

- name: Check if proxy_next_upstream_timeout directive is set in HTTP config file
  when:
    - _http_config_file.proxy_next_upstream_timeout is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_next_upstream_timeout {{ _http_config_file.proxy_next_upstream_timeout }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_next_upstream_timeout_directive

- name: Verify proxy_next_upstream_timeout directive is set in HTTP config file
  when:
    - _http_config_file.proxy_next_upstream_timeout is defined
  ansible.builtin.assert:
    that:
      - not _proxy_next_upstream_timeout_directive.changed
    fail_msg: proxy_next_upstream_timeout directive is not set in HTTP config file.
    success_msg: proxy_next_upstream_timeout directive is set in HTTP config file.

- name: Check if proxy_next_upstream_tries directive is set in HTTP config file
  when:
    - _http_config_file.proxy_next_upstream_tries is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_next_upstream_tries {{ _http_config_file.proxy_next_upstream_tries }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_next_upstream_tries_directive

- name: Verify proxy_next_upstream_tries directive is set in HTTP config file
  when:
    - _http_config_file.proxy_next_upstream_tries is defined
  ansible.builtin.assert:
    that:
      - not _proxy_next_upstream_tries_directive.changed
    fail_msg: proxy_next_upstream_tries directive is not set in HTTP config file.
    success_msg: proxy_next_upstream_tries directive is set in HTTP config file.

- name: Check if proxy_no_cache directive is set in HTTP config file
  when:
    - _http_config_file.proxy_no_cache | default([]) | length > 0
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_no_cache {{ _http_config_file.proxy_no_cache | join(' ') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_no_cache_directive

- name: Verify proxy_no_cache directive is set in HTTP config file
  when:
    - _http_config_file.proxy_no_cache | default([]) | length > 0
  ansible.builtin.assert:
    that:
      - not _proxy_no_cache_directive.changed
    fail_msg: proxy_no_cache directive is not set in HTTP config file.
    success_msg: proxy_no_cache directive is set in HTTP config file.

- name: Check if proxy_pass_header directive is set in HTTP config file
  loop: "{{ _http_config_file.proxy_pass_header | default([]) }}"
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_pass_header {{ item }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_pass_header_directive

- name: Verify proxy_pass_header directive is set in HTTP config file
  loop: "{{ _proxy_pass_header_directive.results }}"
  ansible.builtin.assert:
    that:
      - not item.changed
    fail_msg: proxy_pass_header directive is not set in HTTP config file.
    success_msg: proxy_pass_header directive is set in HTTP config file.
  loop_control:
    label: "{{ item.item }}"

- name: Check if proxy_pass_request_body directive is set in HTTP config file
  when:
    - _http_config_file.proxy_pass_request_body is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_pass_request_body {{ _http_config_file.proxy_pass_request_body | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_pass_request_body_directive

- name: Verify proxy_pass_request_body directive is set in HTTP config file
  when:
    - _http_config_file.proxy_pass_request_body is defined
  ansible.builtin.assert:
    that:
      - not _proxy_pass_request_body_directive.changed
    fail_msg: proxy_pass_request_body directive is not set in HTTP config file.
    success_msg: proxy_pass_request_body directive is set in HTTP config file.

- name: Check if proxy_pass_request_headers directive is set in HTTP config file
  when:
    - _http_config_file.proxy_pass_request_headers is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_pass_request_headers {{ _http_config_file.proxy_pass_request_headers | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_pass_request_headers_directive

- name: Verify proxy_pass_request_headers directive is set in HTTP config file
  when:
    - _http_config_file.proxy_pass_request_headers is defined
  ansible.builtin.assert:
    that:
      - not _proxy_pass_request_headers_directive.changed
    fail_msg: proxy_pass_request_headers directive is not set in HTTP config file.
    success_msg: proxy_pass_request_headers directive is set in HTTP config file.

- name: Check if proxy_read_timeout directive is set in HTTP config file
  when:
    - _http_config_file.proxy_read_timeout is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_read_timeout {{ _http_config_file.proxy_read_timeout }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_read_timeout_directive

- name: Verify proxy_read_timeout directive is set in HTTP config file
  when:
    - _http_config_file.proxy_read_timeout is defined
  ansible.builtin.assert:
    that:
      - not _proxy_read_timeout_directive.changed
    fail_msg: proxy_read_timeout directive is not set in HTTP config file.
    success_msg: proxy_read_timeout directive is set in HTTP config file.

- name: Check if proxy_redirect directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_redirect is defined
    - _http_config_file.proxy_redirect.off | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: proxy_redirect off;
    owner: root
    group: root
    mode: '0640'
  register: _proxy_redirect_off_directive

- name: Verify proxy_redirect directive is set in HTTP config file (off)
  when:
    - _http_config_file.proxy_redirect is defined
    - _http_config_file.proxy_redirect.off | default(false)
  ansible.builtin.assert:
    that:
      - not _proxy_redirect_off_directive.changed
    fail_msg: proxy_redirect directive is not set in HTTP config file.
    success_msg: proxy_redirect directive is set in HTTP config file.

- name: Check if proxy_redirect directive is set in HTTP config file (default)
  when:
    - _http_config_file.proxy_redirect is defined
    - not _http_config_file.proxy_redirect.off | default(false)
    - _http_config_file.proxy_redirect.default | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: proxy_redirect default;
    owner: root
    group: root
    mode: '0640'
  register: _proxy_redirect_default_directive

- name: Verify proxy_redirect directive is set in HTTP config file (default)
  when:
    - _http_config_file.proxy_redirect is defined
    - not _http_config_file.proxy_redirect.off | default(false)
    - _http_config_file.proxy_redirect.default | default(false)
  ansible.builtin.assert:
    that:
      - not _proxy_redirect_default_directive.changed
    fail_msg: proxy_redirect directive is not set in HTTP config file.
    success_msg: proxy_redirect directive is set in HTTP config file.

- name: Check if proxy_redirect directive is set in HTTP config file
  loop: "{{ _http_config_file.proxy_redirect.redirects | default([]) }}"
  when:
    - _http_config_file.proxy_redirect is defined
    - not _http_config_file.proxy_redirect.off | default(false)
    - not _http_config_file.proxy_redirect.default | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_redirect {{ item.original }} {{ item.replacement }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_redirect_directive

- name: Verify proxy_redirect directive is set in HTTP config file
  loop: "{{ _proxy_redirect_directive.results }}"
  when:
    - _http_config_file.proxy_redirect is defined
    - not _http_config_file.proxy_redirect.off | default(false)
    - not _http_config_file.proxy_redirect.default | default(false)
  ansible.builtin.assert:
    that:
      - not item.changed
    fail_msg: proxy_redirect directive is not set in HTTP config file.
    success_msg: proxy_redirect directive is set in HTTP config file.
  loop_control:
    label: "{{ item.item }}"

- name: Check if proxy_request_buffering directive is set in HTTP config file
  when:
    - _http_config_file.proxy_request_buffering is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_request_buffering {{ _http_config_file.proxy_request_buffering | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_request_buffering_directive

- name: Verify proxy_request_buffering directive is set in HTTP config file
  when:
    - _http_config_file.proxy_request_buffering is defined
  ansible.builtin.assert:
    that:
      - not _proxy_request_buffering_directive.changed
    fail_msg: proxy_request_buffering directive is not set in HTTP config file.
    success_msg: proxy_request_buffering directive is set in HTTP config file.

- name: Check if proxy_send_lowat directive is set in HTTP config file
  when:
    - _http_config_file.proxy_send_lowat is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_send_lowat {{ _http_config_file.proxy_send_lowat }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_send_lowat_directive

- name: Verify proxy_send_lowat directive is set in HTTP config file
  when:
    - _http_config_file.proxy_send_lowat is defined
  ansible.builtin.assert:
    that:
      - not _proxy_send_lowat_directive.changed
    fail_msg: proxy_send_lowat directive is not set in HTTP config file.
    success_msg: proxy_send_lowat directive is set in HTTP config file.

- name: Check if proxy_send_timeout directive is set in HTTP config file
  when:
    - _http_config_file.proxy_send_lowat is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_send_timeout {{ _http_config_file.proxy_send_timeout }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_send_timeout_directive

- name: Verify proxy_send_timeout directive is set in HTTP config file
  when:
    - _http_config_file.proxy_send_timeout is defined
  ansible.builtin.assert:
    that:
      - not _proxy_send_timeout_directive.changed
    fail_msg: proxy_send_timeout directive is not set in HTTP config file.
    success_msg: proxy_send_timeout directive is set in HTTP config file.

- name: Check if proxy_set_body directive is set in HTTP config file
  when:
    - _http_config_file.proxy_set_body is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_set_body {{ _http_config_file.proxy_set_body }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_set_body_directive

- name: Verify proxy_set_body directive is set in HTTP config file
  when:
    - _http_config_file.proxy_set_body is defined
  ansible.builtin.assert:
    that:
      - not _proxy_set_body_directive.changed
    fail_msg: proxy_set_body directive is not set in HTTP config file.
    success_msg: proxy_set_body directive is set in HTTP config file.

- name: Check if proxy_set_header directive is set in HTTP config file
  loop: "{{ _http_config_file.proxy_set_header | default([]) }}"
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_set_header {{ item.field }} {{ item.value }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_set_header_directive

- name: Verify proxy_set_header directive is set in HTTP config file
  loop: "{{ _proxy_set_header_directive.results }}"
  ansible.builtin.assert:
    that:
      - not item.changed
    fail_msg: proxy_set_header directive is not set in HTTP config file.
    success_msg: proxy_set_header directive is set in HTTP config file.
  loop_control:
    label: "{{ item.item }}"

- name: Check if proxy_socket_keepalive directive is set in HTTP config file
  when:
    - _http_config_file.proxy_socket_keepalive is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_socket_keepalive {{ _http_config_file.proxy_socket_keepalive | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_socket_keepalive_directive

- name: Verify proxy_socket_keepalive directive is set in HTTP config file
  when:
    - _http_config_file.proxy_socket_keepalive is defined
  ansible.builtin.assert:
    that:
      - not _proxy_socket_keepalive_directive.changed
    fail_msg: proxy_socket_keepalive directive is not set in HTTP config file.
    success_msg: proxy_socket_keepalive directive is set in HTTP config file.

- name: Check if proxy_ssl_certificate directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_certificate is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ssl_certificate {{ _http_config_file.proxy_ssl_certificate }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ssl_certificate_directive

- name: Verify proxy_ssl_certificate directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_certificate is defined
  ansible.builtin.assert:
    that:
      - not _proxy_ssl_certificate_directive.changed
    fail_msg: proxy_ssl_certificate directive is not set in HTTP config file.
    success_msg: proxy_ssl_certificate directive is set in HTTP config file.

- name: Check if proxy_ssl_certificate_key directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_certificate_key is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ssl_certificate_key {{ _http_config_file.proxy_ssl_certificate_key }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ssl_certificate_key_directive

- name: Verify proxy_ssl_certificate_key directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_certificate_key is defined
  ansible.builtin.assert:
    that:
      - not _proxy_ssl_certificate_key_directive.changed
    fail_msg: proxy_ssl_certificate_key directive is not set in HTTP config file.
    success_msg: proxy_ssl_certificate_key directive is set in HTTP config file.

- name: Check if proxy_ssl_ciphers directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_ciphers is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ssl_ciphers {{ _http_config_file.proxy_ssl_ciphers }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ssl_ciphers_directive

- name: Verify proxy_ssl_ciphers directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_ciphers is defined
  ansible.builtin.assert:
    that:
      - not _proxy_ssl_ciphers_directive.changed
    fail_msg: proxy_ssl_ciphers directive is not set in HTTP config file.
    success_msg: proxy_ssl_ciphers directive is set in HTTP config file.

- name: Check if proxy_ssl_conf_command directive is set in HTTP config file
  loop: "{{ _http_config_file.proxy_ssl_conf_command | default([]) }}"
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ssl_conf_command {{ item }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ssl_conf_command_directive

- name: Verify proxy_ssl_conf_command directive is set in HTTP config file
  loop: "{{ _proxy_ssl_conf_command_directive.results }}"
  ansible.builtin.assert:
    that:
      - not item.changed
    fail_msg: proxy_ssl_conf_command directive is not set in HTTP config file.
    success_msg: proxy_ssl_conf_command directive is set in HTTP config file.
  loop_control:
    label: "{{ item.item }}"

- name: Check if proxy_ssl_crl directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_crl is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ssl_crl {{ _http_config_file.proxy_ssl_crl }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ssl_crl_directive

- name: Verify proxy_ssl_crl directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_crl is defined
  ansible.builtin.assert:
    that:
      - not _proxy_ssl_crl_directive.changed
    fail_msg: proxy_ssl_crl directive is not set in HTTP config file.
    success_msg: proxy_ssl_crl directive is set in HTTP config file.

- name: Check if proxy_ssl_name directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_name is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ssl_name {{ _http_config_file.proxy_ssl_name }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ssl_name_directive

- name: Verify proxy_ssl_name directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_name is defined
  ansible.builtin.assert:
    that:
      - not _proxy_ssl_name_directive.changed
    fail_msg: proxy_ssl_name directive is not set in HTTP config file.
    success_msg: proxy_ssl_name directive is set in HTTP config file.

- name: Check if proxy_ssl_password_file directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_password_file is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ssl_password_file {{ _http_config_file.proxy_ssl_password_file }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ssl_password_file_directive

- name: Verify proxy_ssl_password_file directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_password_file is defined
  ansible.builtin.assert:
    that:
      - not _proxy_ssl_password_file_directive.changed
    fail_msg: proxy_ssl_password_file directive is not set in HTTP config file.
    success_msg: proxy_ssl_password_file directive is set in HTTP config file.

- name: Check if proxy_ssl_protocols directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_protocols is defined
    - _http_config_file.proxy_ssl_protocols.sslv2 | default(false) or
      _http_config_file.proxy_ssl_protocols.sslv3 | default(false) or
      _http_config_file.proxy_ssl_protocols.tls1 | default(false) or
      _http_config_file.proxy_ssl_protocols.tls11 | default(false) or
      _http_config_file.proxy_ssl_protocols.tls12 | default(false) or
      _http_config_file.proxy_ssl_protocols.tls13 | default(false)
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: >-
      proxy_ssl_protocols{{ ' SSLv2' if _http_config_file.proxy_ssl_protocols.sslv2 | default(false) -}}
        {{- ' SSLv3' if _http_config_file.proxy_ssl_protocols.sslv3 | default(false) -}}
        {{- ' TLSv1' if _http_config_file.proxy_ssl_protocols.tlsv1 | default(false) -}}
        {{- ' TLSv1.1' if _http_config_file.proxy_ssl_protocols.tlsv11 | default(false) -}}
        {{- ' TLSv1.2' if _http_config_file.proxy_ssl_protocols.tlsv12 | default(false) -}}
        {{- ' TLSv1.3' if _http_config_file.proxy_ssl_protocols.tlsv13 | default(false) }};
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ssl_protocols_directive

- name: Verify proxy_ssl_protocols directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_protocols is defined
    - _http_config_file.proxy_ssl_protocols.sslv2 | default(false) or
      _http_config_file.proxy_ssl_protocols.sslv3 | default(false) or
      _http_config_file.proxy_ssl_protocols.tls1 | default(false) or
      _http_config_file.proxy_ssl_protocols.tls11 | default(false) or
      _http_config_file.proxy_ssl_protocols.tls12 | default(false) or
      _http_config_file.proxy_ssl_protocols.tls13 | default(false)
  ansible.builtin.assert:
    that:
      - not _proxy_ssl_protocols_directive.changed
    fail_msg: proxy_ssl_protocols directive is not set in HTTP config file.
    success_msg: proxy_ssl_protocols directive is set in HTTP config file.

- name: Check if proxy_ssl_server_name directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_server_name is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ssl_server_name {{ _http_config_file.proxy_ssl_server_name | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ssl_server_name_directive

- name: Verify proxy_ssl_server_name directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_server_name is defined
  ansible.builtin.assert:
    that:
      - not _proxy_ssl_server_name_directive.changed
    fail_msg: proxy_ssl_server_name directive is not set in HTTP config file.
    success_msg: proxy_ssl_server_name directive is set in HTTP config file.

- name: Check if proxy_ssl_session_reuse directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_session_reuse is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ssl_session_reuse {{ _http_config_file.proxy_ssl_session_reuse | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ssl_session_reuse_directive

- name: Verify proxy_ssl_session_reuse directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_session_reuse is defined
  ansible.builtin.assert:
    that:
      - not _proxy_ssl_session_reuse_directive.changed
    fail_msg: proxy_ssl_session_reuse directive is not set in HTTP config file.
    success_msg: proxy_ssl_session_reuse directive is set in HTTP config file.

- name: Check if proxy_ssl_trusted_certificate directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_trusted_certificate is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ssl_trusted_certificate {{ _http_config_file.proxy_ssl_trusted_certificate }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ssl_trusted_certificate_directive

- name: Verify proxy_ssl_trusted_certificate directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_trusted_certificate is defined
  ansible.builtin.assert:
    that:
      - not _proxy_ssl_trusted_certificate_directive.changed
    fail_msg: proxy_ssl_trusted_certificate directive is not set in HTTP config file.
    success_msg: proxy_ssl_trusted_certificate directive is set in HTTP config file.

- name: Check if proxy_ssl_verify directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_verify is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ssl_verify {{ _http_config_file.proxy_ssl_verify | ternary('on', 'off') }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ssl_verify_directive

- name: Verify proxy_ssl_verify directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_verify is defined
  ansible.builtin.assert:
    that:
      - not _proxy_ssl_verify_directive.changed
    fail_msg: proxy_ssl_verify directive is not set in HTTP config file.
    success_msg: proxy_ssl_verify directive is set in HTTP config file.

- name: Check if proxy_ssl_verify_depth directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_verify_depth is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_ssl_verify_depth {{ _http_config_file.proxy_ssl_verify_depth }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_ssl_verify_depth_directive

- name: Verify proxy_ssl_verify_depth directive is set in HTTP config file
  when:
    - _http_config_file.proxy_ssl_verify_depth is defined
  ansible.builtin.assert:
    that:
      - not _proxy_ssl_verify_depth_directive.changed
    fail_msg: proxy_ssl_verify_depth directive is not set in HTTP config file.
    success_msg: proxy_ssl_verify_depth directive is set in HTTP config file.

- name: Check if proxy_store directive is set in HTTP config file
  when:
    - _http_config_file.proxy_store is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_store {{ _http_config_file.proxy_store }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_store_directive

- name: Verify proxy_store directive is set in HTTP config file
  when:
    - _http_config_file.proxy_store is defined
  ansible.builtin.assert:
    that:
      - not _proxy_store_directive.changed
    fail_msg: proxy_store directive is not set in HTTP config file.
    success_msg: proxy_store directive is set in HTTP config file.

- name: Check if proxy_store_access directive is set in HTTP config file
  when:
    - _http_config_file.proxy_store_access is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: >-
      proxy_store_access{{ ' user:' + _http_config_file.proxy_store_access.user | string if _http_config_file.proxy_store_access.user is defined -}}
        {{- ' group:' + _http_config_file.proxy_store_access.group | string if _http_config_file.proxy_store_access.group is defined -}}
        {{- ' all:' + _http_config_file.proxy_store_access.all | string if _http_config_file.proxy_store_access.all is defined }};
    owner: root
    group: root
    mode: '0640'
  register: _proxy_store_access_directive

- name: Verify proxy_store_access directive is set in HTTP config file
  when:
    - _http_config_file.proxy_store_access is defined
  ansible.builtin.assert:
    that:
      - not _proxy_store_access_directive.changed
    fail_msg: proxy_store_access directive is not set in HTTP config file.
    success_msg: proxy_store_access directive is set in HTTP config file.

- name: Check if proxy_temp_file_write_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_temp_file_write_size is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: "proxy_temp_file_write_size {{ _http_config_file.proxy_temp_file_write_size }};"
    owner: root
    group: root
    mode: '0640'
  register: _proxy_temp_file_write_size_directive

- name: Verify proxy_temp_file_write_size directive is set in HTTP config file
  when:
    - _http_config_file.proxy_temp_file_write_size is defined
  ansible.builtin.assert:
    that:
      - not _proxy_temp_file_write_size_directive.changed
    fail_msg: proxy_temp_file_write_size directive is not set in HTTP config file.
    success_msg: proxy_temp_file_write_size directive is set in HTTP config file.

- name: Check if proxy_temp_path directive is set in HTTP config file
  when:
    - _http_config_file.proxy_temp_path is defined
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: >-
      proxy_temp_path {{ _http_config_file.proxy_temp_path.path -}}
        {{- ' 1' if _http_config_file.proxy_temp_path.level | default(0) > 0 -}}
        {{- ' 2' if _http_config_file.proxy_temp_path.level | default(0) > 1 -}}
        {{- ' 3' if _http_config_file.proxy_temp_path.level | default(0) > 2 -}};
    owner: root
    group: root
    mode: '0640'
  register: _proxy_temp_path_directive

- name: Verify proxy_temp_path directive is set in HTTP config file
  when:
    - _http_config_file.proxy_temp_path is defined
  ansible.builtin.assert:
    that:
      - not _proxy_temp_path_directive.changed
    fail_msg: proxy_temp_path directive is not set in HTTP config file.
    success_msg: proxy_temp_path directive is set in HTTP config file.

- name: Check if proxy_cache_path directive is set in HTTP config file
  loop: "{{ _http_config_file.proxy_cache_path | default([]) }}"
  become: true
  check_mode: true
  ansible.builtin.lineinfile:
    path: "{{ _http_config_file.destination }}"
    line: >-
      proxy_cache_path {{ item.path -}}
        {%- if item.levels | default(0) > 0 -%}
        {{- ' levels=1' -}}
        {{- ':2' if item.levels > 1 -}}
        {{- ':3' if item.levels > 2 -}}
        {%- endif -%}
        {{- ' use_temp_path=' + item.use_temp_path | ternary('on', 'off') if item.use_temp_path is defined -}}
        {{- ' keys_zone=' + item.keys_zone.name | string + ':' + item.keys_zone.size | string -}}
        {{- ' inactive=' + item.inactive | string if item.inactive is defined -}}
        {{- ' max_size=' + item.max_size | string if item.max_size is defined -}}
        {{- ' min_free=' + item.min_free | string if item.min_free is defined -}}
        {{- ' manager_files=' + item.manager_files | string if item.manager_files is defined -}}
        {{- ' manager_sleep=' + item.manager_sleep | string if item.manager_sleep is defined -}}
        {{- ' manager_threshold=' + item.manager_threshold | string if item.manager_threshold is defined -}}
        {{- ' loader_files=' + item.loader_files | string if item.loader_files is defined -}}
        {{- ' loader_sleep=' + item.loader_sleep | string if item.loader_sleep is defined -}}
        {{- ' loader_threshold=' + item.loader_threshold | string if item.loader_threshold is defined -}}
        {{- ' purger=' + item.purger | ternary('on', 'off') if item.purger is defined -}}
        {{- ' purger_files=' + item.purger_files | string if item.purger_files is defined -}}
        {{- ' purger_sleep=' + item.purger_sleep | string if item.purger_sleep is defined -}}
        {{- ' purger_threshold=' + item.purger_threshold | string if item.purger_threshold is defined }};
    owner: root
    group: root
    mode: '0640'
  register: _proxy_cache_path_directive

- name: Verify proxy_cache_path directive is set in HTTP config file
  loop: "{{ _proxy_cache_path_directive.results }}"
  ansible.builtin.assert:
    that:
      - not item.changed
    fail_msg: proxy_cache_path directive is not set in HTTP config file.
    success_msg: proxy_cache_path directive is set in HTTP config file.
  loop_control:
    label: "{{ item.item }}"
